#
#
#
version: '2'


services:
  traefik:
    image: traefik:latest
    restart: always
    ports:
      - "80:80"
      - "443:443"
      - "8000:8000"
    networks:
      - webLAN
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./traefik/traefik.toml:/traefik.toml
      - ./certs/:/certs/
    container_name: traefik

  web:
    image: nginx:latest
    container_name: nginx_webserver
    ports:
      - "8888:80"
    networks:
      - webLAN
    volumes:
      - ./www_site:/www_site
      - ./site.conf:/etc/nginx/conf.d/default.conf
    links:
      - php
      - mysql_webserver
    labels:
      - "traefik.backend=webserver"
      - "traefik.docker.network=web_server_webLAN"
      - "traefik.frontend.rule=PathPrefix: /"
      - "traefik.frontend.entryPoints=http,https"
      - "traefik.frontend.headers.SSLRedirect=true"
      - "traefik.enable=true"
      - "traefik.port=80"
      - "traefik.default.protocol=http"




  php:
    #image: php:7-fpm
    build: php/.
    container_name: php_webserver
    volumes:
      - ./www_site:/www_site
    networks:
      - webLAN
      - sqlLAN
    links:
      - mysql_webserver
    labels:
      - "traefik.enable=false"

  mysql_webserver:
    build: ./mysql/
    container_name: mysql_webserver
    # for debug
    #ports:
    #  - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=AZ56FG78HJZE34
    networks:
        - sqlLAN
    labels:
      - "traefik.enable=false"
      
networks:
  webLAN:
    driver: bridge
  sqlLAN:
    driver: bridge